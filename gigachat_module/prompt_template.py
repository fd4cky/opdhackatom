"""
Универсальный шаблон-конструктор для генерации промптов изображений
"""
from typing import Optional, Dict, List


def build_image_prompt(
    holiday_name: str,
    profession: Optional[str] = None,
    company_name: Optional[str] = None,
    client_status: str = "стандартный",
    preferences: Optional[List[str]] = None,
    tone: str = "официальный"
) -> str:
    """
    Универсальный шаблон-конструктор для генерации промпта изображения
    
    Args:
        holiday_name: Название праздника (обязательно)
        profession: Название профессии/должности (опционально)
        company_name: Название компании (опционально)
        client_status: Статус клиента (VIP, новый, лояльный, стандартный)
        preferences: Индивидуальные предпочтения клиента (опционально)
        tone: Тон изображения (официальный, дружеский, креативный)
    
    Returns:
        Сформированный промпт для генерации изображения
    """
    # НАЧАЛО ПРОМПТА: СРАЗУ ПОДЧЕРКИВАЕМ ЗАПРЕТ НА ТЕКСТ И ЛЮДЕЙ
    prompt = (
        'КРИТИЧЕСКИ ВАЖНО: НА ИЗОБРАЖЕНИИ НЕ ДОЛЖНО БЫТЬ НИКАКОГО ТЕКСТА И НИКАКИХ ЛЮДЕЙ. '
        'ЗАПРЕЩЕНО ДОБАВЛЯТЬ ТЕКСТ, СЛОВА, БУКВЫ, ЦИФРЫ, НАДПИСИ НА ИЗОБРАЖЕНИЕ. '
        'ЗАПРЕЩЕНО ДОБАВЛЯТЬ ЛЮДЕЙ, ЧЕЛОВЕЧЕСКИЕ ФИГУРЫ, ЛИЦА, ПОРТРЕТЫ НА ИЗОБРАЖЕНИЕ. '
        'ИЗОБРАЖЕНИЕ ДОЛЖНО СОДЕРЖАТЬ ТОЛЬКО ПРЕДМЕТЫ И СИМВОЛЫ, СВЯЗАННЫЕ С ПРАЗДНИКОМ - БЕЗ ЛЮДЕЙ И БЕЗ ТЕКСТА. '
    )
    
    # Основной промпт
    prompt += f'Создай картинку по тематике праздника "{holiday_name}"'
    
    # Добавляем должность, если указана
    if profession:
        prompt += f' для человека занимающего должность "{profession}"'
    
    # Добавляем компанию, если указана
    if company_name:
        # Очищаем название компании от лишних символов
        clean_company = company_name.replace("'", "").replace('"', '').replace("ООО", "").strip()
        if clean_company:
            prompt += f' в компании "{clean_company}"'
    
    # Добавляем статус клиента
    prompt += f' и имеющий статус "{client_status}" клиента'
    
    # Добавляем тон
    prompt += f', картинка должна иметь "{tone}" тон'
    
    # ПОВТОРНЫЙ ЗАПРЕТ НА ТЕКСТ В СЕРЕДИНЕ
    prompt += (
        '. ПОВТОРЯЮ: НА ИЗОБРАЖЕНИИ НЕ ДОЛЖНО БЫТЬ НИКАКОГО ТЕКСТА, НИКАКИХ СЛОВ, НИКАКИХ БУКВ, '
        'НИКАКИХ ЦИФР, НИКАКИХ НАДПИСЕЙ - ТОЛЬКО ВИЗУАЛЬНЫЕ ЭЛЕМЕНТЫ. '
    )
    
    # Добавляем требования - ТОЛЬКО ПРЕДМЕТЫ И СИМВОЛЫ
    prompt += (
        'Картинка должна учитывать индивидуальные предпочтения каждого клиента, '
        'вызывать праздничное настроение. '
        'ИЗОБРАЖЕНИЕ ДОЛЖНО СОДЕРЖАТЬ ТОЛЬКО ПРЕДМЕТЫ И СИМВОЛЫ, СВЯЗАННЫЕ С ЭТИМ ПРАЗДНИКОМ: '
        'праздничные предметы, символы праздника, декоративные элементы, связанные с праздником. '
        'Картинка должна быть гендерно нейтральна, вызывать чувство радости и веселья. '
    )
    
    # КРИТИЧЕСКИ ВАЖНО: Запрет на людей и текст - ТОЛЬКО ПРЕДМЕТЫ
    prompt += (
        'КРИТИЧЕСКИ ВАЖНО: На изображении НЕ ДОЛЖНО быть людей, никаких людей, никаких человеческих фигур, '
        'никаких лиц, никаких портретов, никаких силуэтов людей, никаких персонажей, никаких людей вообще. '
        'ИЗОБРАЖЕНИЕ ДОЛЖНО СОДЕРЖАТЬ ТОЛЬКО ПРЕДМЕТЫ И СИМВОЛЫ ПРАЗДНИКА - БЕЗ ЛЮДЕЙ. '
        'ТОЛЬКО ПРЕДМЕТЫ: праздничные предметы, символы, декоративные элементы, связанные с праздником. '
    )
    
    # МАКСИМАЛЬНОЕ УСИЛЕНИЕ ЗАПРЕТА НА ТЕКСТ И ЛЮДЕЙ - ПОВТОРЯЕМ МНОЖЕСТВО РАЗ
    prompt += (
        'ОБЯЗАТЕЛЬНО: Картинка должна быть СТРОГО БЕЗ НАДПИСЕЙ, СТРОГО БЕЗ ТЕКСТА, СТРОГО БЕЗ СЛОВ, '
        'СТРОГО БЕЗ БУКВ, СТРОГО БЕЗ ЦИФР, СТРОГО БЕЗ ЛОГОТИПОВ С ТЕКСТОМ, СТРОГО БЕЗ ПОДПИСЕЙ, '
        'СТРОГО БЕЗ ЛЮБЫХ ТЕКСТОВЫХ ЭЛЕМЕНТОВ. '
        'НА ИЗОБРАЖЕНИИ НЕ ДОЛЖНО БЫТЬ НИКАКОГО ТЕКСТА ВООБЩЕ. '
        'ЗАПРЕЩЕНО ДОБАВЛЯТЬ ТЕКСТ НА ИЗОБРАЖЕНИЕ. '
        'СТРОГО БЕЗ ЛЮДЕЙ, БЕЗ ЧЕЛОВЕЧЕСКИХ ФИГУР, БЕЗ ЛИЦ, БЕЗ ПОРТРЕТОВ, БЕЗ СИЛУЭТОВ ЛЮДЕЙ. '
        'ИЗОБРАЖЕНИЕ ДОЛЖНО СОДЕРЖАТЬ ТОЛЬКО ПРЕДМЕТЫ И СИМВОЛЫ ПРАЗДНИКА - БЕЗ ЛЮДЕЙ И БЕЗ ТЕКСТА. '
        'ТОЛЬКО ПРЕДМЕТЫ: праздничные предметы, символы праздника, декоративные элементы. '
        'НИКАКИХ СЛОВ, НИКАКИХ БУКВ, НИКАКИХ ЦИФР, НИКАКИХ НАДПИСЕЙ, НИКАКИХ ЛЮДЕЙ - ТОЛЬКО ПРЕДМЕТЫ И СИМВОЛЫ. '
        'ТЕКСТА НА ИЗОБРАЖЕНИИ БЫТЬ НЕ ДОЛЖНО. ЛЮДЕЙ НА ИЗОБРАЖЕНИИ БЫТЬ НЕ ДОЛЖНО. '
        'ТОЛЬКО ПРЕДМЕТЫ И СИМВОЛЫ ПРАЗДНИКА.'
    )
    
    # Добавляем индивидуальные предпочтения, если указаны
    if preferences:
        prefs_text = ", ".join(preferences)
        prompt += f' Учти индивидуальные предпочтения: {prefs_text}.'
        # После предпочтений снова подчеркиваем запрет
        prompt += ' НО ПОМНИ: НА ИЗОБРАЖЕНИИ НЕ ДОЛЖНО БЫТЬ ТЕКСТА.'
    
    # ФИНАЛЬНОЕ ПОДЧЕРКИВАНИЕ - ТОЛЬКО ПРЕДМЕТЫ, БЕЗ ТЕКСТА И ЛЮДЕЙ
    prompt += (
        ' ФИНАЛЬНОЕ ТРЕБОВАНИЕ: ИЗОБРАЖЕНИЕ ДОЛЖНО СОДЕРЖАТЬ ТОЛЬКО ПРЕДМЕТЫ И СИМВОЛЫ, СВЯЗАННЫЕ С ПРАЗДНИКОМ. '
        'НЕ ДОБАВЛЯЙ ТЕКСТ НА ИЗОБРАЖЕНИЕ. НЕ ДОБАВЛЯЙ ЛЮДЕЙ НА ИЗОБРАЖЕНИЕ. '
        'НИКАКОГО ТЕКСТА. НИКАКИХ ЛЮДЕЙ. '
        'ТОЛЬКО ПРЕДМЕТЫ И СИМВОЛЫ ПРАЗДНИКА - БЕЗ ТЕКСТА И БЕЗ ЛЮДЕЙ. '
        'ТЕКСТА НА ИЗОБРАЖЕНИИ БЫТЬ НЕ ДОЛЖНО. ЛЮДЕЙ НА ИЗОБРАЖЕНИИ БЫТЬ НЕ ДОЛЖНО. '
        'ТОЛЬКО ПРЕДМЕТЫ И СИМВОЛЫ ПРАЗДНИКА.'
    )
    
    return prompt


def build_simple_image_prompt(
    holiday_name: str,
    profession: Optional[str] = None,
    company_name: Optional[str] = None,
    client_status: str = "стандартный",
    preferences: Optional[List[str]] = None
) -> str:
    """
    Упрощенная версия шаблона для коротких промптов
    
    Args:
        holiday_name: Название праздника
        profession: Название профессии/должности
        company_name: Название компании
        client_status: Статус клиента
        preferences: Индивидуальные предпочтения
    
    Returns:
        Упрощенный промпт
    """
    parts = []
    
    # Праздник
    parts.append(f'праздник "{holiday_name}"')
    
    # Профессия
    if profession:
        parts.append(f'профессия "{profession}"')
    
    # Компания
    if company_name:
        clean_company = company_name.replace("'", "").replace('"', '').replace("ООО", "").strip()
        if clean_company:
            parts.append(f'компания "{clean_company}"')
    
    # Статус
    parts.append(f'статус "{client_status}"')
    
    # Предпочтения
    if preferences:
        parts.append(f'предпочтения: {", ".join(preferences)}')
    
    prompt = ", ".join(parts)
    prompt += ", праздничное настроение, радость, веселье, праздничные символы, гендерно нейтрально, без людей, БЕЗ ТЕКСТА, БЕЗ НАДПИСЕЙ, только визуальные элементы"
    
    return prompt

