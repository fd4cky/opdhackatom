# Telegram бот для автоматической отправки поздравительных сообщений

Telegram бот для автоматической отправки персонализированных поздравительных изображений пользователям в дни их праздников.

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Создайте бота через @BotFather в Telegram:
   - Откройте Telegram и найдите @BotFather
   - Отправьте команду `/newbot`
   - Следуйте инструкциям для создания бота
   - Скопируйте полученный токен

3. Получите ваш Telegram ID:
   - Найдите бота @userinfobot в Telegram
   - Отправьте ему любое сообщение
   - Скопируйте ваш ID (число)

4. Добавьте настройки в `.env` файл:
```env
TELEGRAM_BOT_TOKEN=ваш_токен_бота
TELEGRAM_ADMIN_IDS=ваш_telegram_id
GIGACHAT_CREDENTIALS=ваш_ключ_gigachat
```

Для нескольких админов используйте запятую:
```env
TELEGRAM_ADMIN_IDS=123456789,987654321
```

## Запуск

```bash
python telegram_bot/bot.py
```

## Использование

### Для обычных пользователей

Обычные пользователи не могут отправлять команды боту. Бот работает автоматически и отправляет поздравления пользователям в дни их праздников.

### Для администраторов

Администраторы могут управлять датой и режимом работы бота:

#### Команды:

- **`/start`** - приветствие и информация о текущем режиме работы

#### Управление датой:

- **`+`** - активировать автоматический режим
  - Бот будет использовать текущую дату системы
  - Планировщик будет проверять праздники каждый день в 9:00

- **`-`** - активировать ручной режим
  - Бот будет использовать установленную дату
  - После активации отправьте дату в формате DD.MM.YYYY

- **`DD.MM.YYYY`** - установить дату (например: `01.01.2025`)
  - Устанавливает дату для проверки праздников
  - Автоматически переключает бот в ручной режим
  - Сразу проверяет праздники на эту дату и отправляет поздравления

## Режимы работы

### Автоматический режим (+)

- Бот использует текущую дату системы
- Планировщик проверяет праздники каждый день в 9:00 утра
- Отправляет поздравления пользователям автоматически

### Ручной режим (-)

- Бот использует установленную администратором дату
- Планировщик проверяет праздники на установленную дату
- Позволяет тестировать отправку поздравлений на любую дату

## Как это работает

1. Бот проверяет базы данных `users.csv` и `holidays.csv`
2. Для каждого праздника определяет, кому нужно отправить поздравление:
   - **Для всех** - всем активированным пользователям (с `telegram_chat_id`)
   - **Для мужчин** - только мужчинам
   - **Для женщин** - только женщинам
   - **Для сотрудников** - только сотрудникам (user_type = employee)
   - **Для клиентов** - только клиентам (user_type = client)
   - **Для IT-специалистов** - пользователям с IT-интересами
3. Генерирует персонализированный текст и изображение для каждого пользователя
4. Отправляет поздравление пользователю по его `telegram_chat_id`

## Реферальные коды

Каждый пользователь в базе данных имеет уникальный реферальный код (10-12 символов). Пользователь должен активировать свой аккаунт, перейдя по ссылке:

```
https://t.me/ваш_бот?start=РЕФЕРАЛЬНЫЙ_КОД
```

После активации:
- Бот сохраняет `telegram_chat_id` пользователя
- Реферальный код становится недействительным (можно использовать только один раз)
- Пользователь начинает получать автоматические поздравления

## Важно

- Пользователи должны активировать свой аккаунт через реферальную ссылку перед получением поздравлений
- Бот отправляет поздравления только пользователям, у которых указан `telegram_chat_id` в базе данных `users.csv` (активированным пользователям)
- Каждый реферальный код можно использовать только один раз
- Для получения Telegram ID используйте бота @userinfobot

## Структура баз данных

### users.csv

Должен содержать:
- `referral_code` - уникальный реферальный код пользователя (генерируется автоматически)
- `telegram_chat_id` - заполняется автоматически после активации пользователем через реферальную ссылку

### holidays.csv

Содержит праздники с полями:
- `holiday_name` - название праздника
- `date_fixed` - дата праздника (формат YYYY-MM-DD)
- `description` - описание, кому отправлять (Для всех, Для мужчин, Для женщин, Для сотрудников, и т.д.)

## Примеры

### Установка даты и отправка поздравлений

Администратор отправляет:
```
01.01.2025
```

Бот:
- Устанавливает дату 01.01.2025
- Переключается в ручной режим
- Проверяет праздники на эту дату
- Отправляет поздравления всем пользователям, у которых в этот день праздник

### Переключение в автоматический режим

Администратор отправляет:
```
+
```

Бот переключается в автоматический режим и будет использовать текущую дату.
